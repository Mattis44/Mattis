---
const { class: extra = "" } = Astro.props;
---

<div class={`tilt-card-wrapper relative ${extra}`}>
    <slot />
</div>

<script is:inline>
    document.querySelectorAll(".tilt-card-wrapper").forEach((card) => {
        const strength = 4;
        let currentX = 0;
        let currentY = 0;
        let targetX = 0;
        let targetY = 0;

        const lerp = (a, b, n) => (1 - n) * a + n * b;

        function animate() {
            currentX = lerp(currentX, targetX, 0.1);
            currentY = lerp(currentY, targetY, 0.1);

            card.style.transform = `perspective(900px) rotateX(${currentY}deg) rotateY(${currentX}deg)`;

            requestAnimationFrame(animate);
        }
        animate();

        card.addEventListener("mousemove", (e) => {
            const rect = card.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;

            targetX = (x / rect.width - 0.5) * strength * 2;
            targetY = (y / rect.height - 0.5) * -strength * 2;
        });

        card.addEventListener("mouseleave", () => {
            targetX = 0;
            targetY = 0;
        });
    });
</script>

<style>
    .tilt-card-wrapper {
        transition: transform 0.2s ease-out;
        will-change: transform;
    }
</style>
